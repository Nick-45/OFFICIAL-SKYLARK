<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDUSKYLARK · My Classes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        /* ----- EDUSKYLARK TEACHER THEME (TEAL) ----- */
        :root {
            --teal: #1abc9c;
            --teal-dark: #16a085;
            --blue: #3498db;
            --orange: #e67e22;
            --red: #e74c3c;
            --dark-blue: #2c3e50;
            --white: #ffffff;
            --light-blue: #ecf0f1;
            --green: #27ae60;
            --purple: #9b59b6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #ecf0f1 0%, #d6dbdf 100%); min-height: 100vh; color: var(--dark-blue); }
        
        /* Copy all dashboard styles from teacher-dashboard.html */
        .background-animation { position: fixed; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .bubble { position: absolute; border-radius: 50%; background: rgba(26,188,156,0.1); animation: float 15s infinite ease-in-out; }
        @keyframes float { 0%,100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-20px) scale(1.05); } }
        
        .header { background: linear-gradient(135deg, var(--dark-blue) 0%, #1a2530 100%); color: white; padding: 20px 30px; position: sticky; top: 0; z-index: 100; }
        .header-content { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; }
        .logo-section { display: flex; align-items: center; gap: 20px; }
        .logo { width: 60px; height: 60px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .church-info h1 { font-size: 24px; font-weight: 700; }
        .church-info p { font-size: 14px; color: var(--teal); }
        .teacher-badge { display: inline-flex; align-items: center; gap: 5px; background: linear-gradient(135deg, var(--teal), var(--teal-dark)); color: white; padding: 3px 10px; border-radius: 15px; font-size: 12px; margin-left: 10px; }
        
        .dashboard-container { max-width: 1400px; margin: 30px auto; padding: 0 20px; animation: fadeIn 1s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-header h2 { font-size: 28px; display: flex; align-items: center; gap: 15px; }
        .page-header h2 i { color: var(--teal); }
        
        .stats-cards {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: white; border-radius: 16px; padding: 20px; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03); border-left: 4px solid var(--teal);
        }
        .stat-icon { width: 50px; height: 50px; border-radius: 50%; background: rgba(26,188,156,0.1); display: flex; align-items: center; justify-content: center; color: var(--teal); font-size: 20px; }
        
        .classes-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-bottom: 40px;
        }
        .class-card {
            background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border-left: 5px solid var(--teal); transition: all 0.3s; cursor: pointer;
        }
        .class-card:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        
        .class-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .class-title { font-size: 22px; font-weight: 700; color: var(--dark-blue); }
        .class-badge { padding: 4px 12px; border-radius: 30px; font-size: 12px; font-weight: 600; background: rgba(26,188,156,0.1); color: var(--teal); }
        
        .class-details { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .detail-item { display: flex; align-items: center; gap: 10px; color: #666; font-size: 14px; }
        .detail-item i { width: 20px; color: var(--teal); }
        
        .progress-section { margin-top: 20px; }
        .progress-label { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px; }
        .progress-bar { height: 8px; background: #e9ecef; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--teal); border-radius: 10px; width: 0%; }
        
        .action-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .btn { padding: 10px 20px; border-radius: 30px; border: none; font-weight: 600; cursor: pointer; transition: all 0.3s; font-size: 14px; }
        .btn-primary { background: linear-gradient(135deg, var(--teal), var(--teal-dark)); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--teal); color: var(--teal); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(26,188,156,0.3); }
        
        @media (max-width: 768px) { .menu-toggle { display: block; } .user-section { display: none; } }
    </style>
</head>
<body>
    <div class="background-animation">
        <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
    </div>

    <header class="header">
        <div class="header-content">
            <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
            <div class="logo-section">
                <div class="logo"><img src="logo.png" alt="EDUSKYLARK" onerror="this.src='https://cdn-icons-png.flaticon.com/512/217/217853.png'"></div>
                <div class="church-info">
                    <h1>EDUSKYLARK · MY CLASSES <span class="teacher-badge"><i class="fas fa-chalkboard-teacher"></i> TEACHER</span></h1>
                    <p>Manage Your Classes & Students</p>
                </div>
            </div>
            <div class="user-section" id="userSection"></div>
        </div>
    </header>

    <main class="dashboard-container">
        <div class="page-header">
            <h2><i class="fas fa-door-open"></i> My Classes</h2>
            <button class="btn-primary" style="padding: 12px 25px;" onclick="window.location.href='teacher-create-class.html'">
                <i class="fas fa-plus-circle"></i> Create New Class
            </button>
        </div>

        <!-- Stats Cards -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-chalkboard"></i></div>
                <div><h4>Total Classes</h4><span style="font-size: 28px; font-weight: 700;" id="totalClasses">4</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div><h4>Total Students</h4><span style="font-size: 28px; font-weight: 700;" id="totalStudents">155</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                <div><h4>Avg Attendance</h4><span style="font-size: 28px; font-weight: 700;" id="avgAttendance">92%</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                <div><h4>Active Assignments</h4><span style="font-size: 28px; font-weight: 700;" id="activeAssignments">12</span></div>
            </div>
        </div>

        <!-- Classes Grid -->
        <div class="classes-grid" id="classesGrid"></div>
    </main>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAz5knhlAxZwUATy3mtW66Z6lHBrv4tUog",
            authDomain: "toplink-edu.firebaseapp.com",
            projectId: "toplink-edu",
            storageBucket: "toplink-edu.firebasestorage.app",
            messagingSenderId: "35786900143",
            appId: "1:35786900143:web:9e612336393d29324c0a5a"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.onAuthStateChanged(async (user) => {
            if (!user) window.location.href = 'teacher-login.html';
            else {
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (!userDoc.exists || (userDoc.data().role !== 'teacher' && userDoc.data().role !== 'educator')) {
                    await auth.signOut();
                    window.location.href = 'teacher-login.html';
                } else {
                    loadUserData(userDoc.data());
                    loadTeacherClasses(user.uid, userDoc.data().schoolId);
                }
            }
        });

        function loadUserData(data) {
            document.getElementById('userSection').innerHTML = `
                <div style="display:flex; align-items:center; gap:20px; color:white;">
                    <span>${data.fullName || 'Teacher'}</span>
                    <button class="logout-btn" id="logoutBtn" style="background:rgba(231,76,60,0.2); color:white; border:2px solid var(--red); padding:8px 16px; border-radius:30px; cursor:pointer;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            `;
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                await auth.signOut();
                window.location.href = 'teacher-login.html';
            });
        }

        async function loadTeacherClasses(teacherId, schoolId) {
            const classesGrid = document.getElementById('classesGrid');
            
            try {
                const classesSnap = await db.collection('classes')
                    .where('teacherId', '==', teacherId)
                    .where('schoolId', '==', schoolId)
                    .get();

                if (classesSnap.empty) {
                    classesGrid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:60px; background:white; border-radius:20px;"><i class="fas fa-door-open" style="font-size:48px; color:var(--teal); opacity:0.5;"></i><h3 style="margin-top:20px;">No Classes Found</h3><p style="color:#666; margin-top:10px;">You haven\'t been assigned any classes yet.</p></div>';
                    return;
                }

                let html = '';
                classesSnap.forEach(doc => {
                    const c = doc.data();
                    const studentCount = c.studentIds?.length || 0;
                    const assignmentCount = c.assignmentIds?.length || 0;
                    const attendanceRate = c.attendanceRate || 92;
                    
                    html += `
                        <div class="class-card" onclick="window.location.href='teacher-class-details.html?id=${doc.id}'">
                            <div class="class-header">
                                <div>
                                    <div class="class-title">${c.name || 'Unnamed Class'}</div>
                                    <div style="color: #666; margin-top: 5px;">${c.subject || 'Subject not set'}</div>
                                </div>
                                <span class="class-badge">${c.grade || 'Form 1'}</span>
                            </div>
                            <div class="class-details">
                                <div class="detail-item"><i class="fas fa-users"></i> ${studentCount} Students</div>
                                <div class="detail-item"><i class="fas fa-calendar"></i> ${c.schedule || 'Mon, Wed, Fri'}</div>
                                <div class="detail-item"><i class="fas fa-clock"></i> ${c.time || '08:00 - 09:30'}</div>
                                <div class="detail-item"><i class="fas fa-map-marker-alt"></i> ${c.room || 'Room 101'}</div>
                                <div class="detail-item"><i class="fas fa-tasks"></i> ${assignmentCount} Assignments</div>
                                <div class="detail-item"><i class="fas fa-pencil-alt"></i> ${c.examCount || 2} Exams</div>
                            </div>
                            <div class="progress-section">
                                <div class="progress-label">
                                    <span>Attendance Rate</span>
                                    <span style="font-weight:600;">${attendanceRate}%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${attendanceRate}%;"></div>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="event.stopPropagation(); window.location.href='teacher-attendance.html?class=${doc.id}'">
                                    <i class="fas fa-calendar-check"></i> Attendance
                                </button>
                                <button class="btn btn-outline" onclick="event.stopPropagation(); window.location.href='teacher-assignments.html?class=${doc.id}'">
                                    <i class="fas fa-tasks"></i> Assignments
                                </button>
                            </div>
                        </div>
                    `;
                });
                classesGrid.innerHTML = html;
                document.getElementById('totalClasses').textContent = classesSnap.size;
                
            } catch (error) {
                console.error('Error loading classes:', error);
                // Demo data
                document.getElementById('classesGrid').innerHTML = getDemoClasses();
            }
        }

        function getDemoClasses() {
            return `
                <div class="class-card" onclick="window.location.href='teacher-class-details.html?id=1A'">
                    <div class="class-header"><div><div class="class-title">Form 1A</div><div style="color:#666;">Mathematics</div></div><span class="class-badge">Form 1</span></div>
                    <div class="class-details"><div class="detail-item"><i class="fas fa-users"></i> 42 Students</div><div class="detail-item"><i class="fas fa-calendar"></i> Mon, Wed, Fri</div><div class="detail-item"><i class="fas fa-clock"></i> 08:00 - 09:30</div><div class="detail-item"><i class="fas fa-map-marker-alt"></i> Room 101</div><div class="detail-item"><i class="fas fa-tasks"></i> 5 Assignments</div><div class="detail-item"><i class="fas fa-pencil-alt"></i> 2 Exams</div></div>
                    <div class="progress-section"><div class="progress-label"><span>Attendance Rate</span><span style="font-weight:600;">92%</span></div><div class="progress-bar"><div class="progress-fill" style="width:92%;"></div></div></div>
                    <div class="action-buttons"><button class="btn btn-primary" onclick="event.stopPropagation(); window.location.href='teacher-attendance.html?class=1A'"><i class="fas fa-calendar-check"></i> Attendance</button><button class="btn btn-outline" onclick="event.stopPropagation(); window.location.href='teacher-assignments.html?class=1A'"><i class="fas fa-tasks"></i> Assignments</button></div>
                </div>
                <div class="class-card" onclick="window.location.href='teacher-class-details.html?id=2B'">
                    <div class="class-header"><div><div class="class-title">Form 2B</div><div style="color:#666;">Physics</div></div><span class="class-badge">Form 2</span></div>
                    <div class="class-details"><div class="detail-item"><i class="fas fa-users"></i> 38 Students</div><div class="detail-item"><i class="fas fa-calendar"></i> Tue, Thu</div><div class="detail-item"><i class="fas fa-clock"></i> 10:00 - 11:30</div><div class="detail-item"><i class="fas fa-map-marker-alt"></i> Lab 203</div><div class="detail-item"><i class="fas fa-tasks"></i> 3 Assignments</div><div class="detail-item"><i class="fas fa-pencil-alt"></i> 1 Exam</div></div>
                    <div class="progress-section"><div class="progress-label"><span>Attendance Rate</span><span style="font-weight:600;">88%</span></div><div class="progress-bar"><div class="progress-fill" style="width:88%;"></div></div></div>
                    <div class="action-buttons"><button class="btn btn-primary"><i class="fas fa-calendar-check"></i> Attendance</button><button class="btn btn-outline"><i class="fas fa-tasks"></i> Assignments</button></div>
                </div>
                <div class="class-card" onclick="window.location.href='teacher-class-details.html?id=3C'">
                    <div class="class-header"><div><div class="class-title">Form 3C</div><div style="color:#666;">Additional Mathematics</div></div><span class="class-badge">Form 3</span></div>
                    <div class="class-details"><div class="detail-item"><i class="fas fa-users"></i> 35 Students</div><div class="detail-item"><i class="fas fa-calendar"></i> Mon, Wed</div><div class="detail-item"><i class="fas fa-clock"></i> 11:30 - 13:00</div><div class="detail-item"><i class="fas fa-map-marker-alt"></i> Room 305</div><div class="detail-item"><i class="fas fa-tasks"></i> 4 Assignments</div><div class="detail-item"><i class="fas fa-pencil-alt"></i> 2 Exams</div></div>
                    <div class="progress-section"><div class="progress-label"><span>Attendance Rate</span><span style="font-weight:600;">94%</span></div><div class="progress-bar"><div class="progress-fill" style="width:94%;"></div></div></div>
                    <div class="action-buttons"><button class="btn btn-primary"><i class="fas fa-calendar-check"></i> Attendance</button><button class="btn btn-outline"><i class="fas fa-tasks"></i> Assignments</button></div>
                </div>
                <div class="class-card" onclick="window.location.href='teacher-class-details.html?id=4A'">
                    <div class="class-header"><div><div class="class-title">Form 4A</div><div style="color:#666;">Chemistry</div></div><span class="class-badge">Form 4</span></div>
                    <div class="class-details"><div class="detail-item"><i class="fas fa-users"></i> 40 Students</div><div class="detail-item"><i class="fas fa-calendar"></i> Tue, Thu, Fri</div><div class="detail-item"><i class="fas fa-clock"></i> 14:00 - 15:30</div><div class="detail-item"><i class="fas fa-map-marker-alt"></i> Lab 101</div><div class="detail-item"><i class="fas fa-tasks"></i> 2 Assignments</div><div class="detail-item"><i class="fas fa-pencil-alt"></i> 3 Exams</div></div>
                    <div class="progress-section"><div class="progress-label"><span>Attendance Rate</span><span style="font-weight:600;">91%</span></div><div class="progress-bar"><div class="progress-fill" style="width:91%;"></div></div></div>
                    <div class="action-buttons"><button class="btn btn-primary"><i class="fas fa-calendar-check"></i> Attendance</button><button class="btn btn-outline"><i class="fas fa-tasks"></i> Assignments</button></div>
                </div>
            `;
        }

        // Mobile menu (simplified)
        document.getElementById('menuToggle').addEventListener('click', () => alert('Mobile menu would open'));
    </script>
</body>
</html>
